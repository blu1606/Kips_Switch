# 14.1 Smart Contract Testing Strategy

> **Status:** Planned
> **Goal:** Establish a robust "Ironclad" testing pipeline.
> **Priority:** Bankrun (P0) > Trident (P2/Stretch)

## ðŸŽ¯ Objectives
1.  **Velocity:** Reduce test feedback loop from ~10s to <1s (Bankrun).
2.  **Security:** (Optional for v1) Fuzz testing via Trident.
3.  **Organization:** Decouple monolithic test files.

## ðŸ“ Strategy: The Trinity

### 1. Speed Layer: `solana-bankrun` (Primary Focus)
- **Tool:** [solana-bankrun](https://kevinheavey.github.io/solana-bankrun/)
- **Role:** fast unit testing for instruction logic.
- **Strategy:** Isolate the "Happy Path" logic here to get immediate feedback during dev.
- **Target:** 90% of logic tests.

### 2. Security Layer: Trident Fuzzing (Stretch Goal)
- **Tool:** [Trident](https://ackee.xyz/trident/)
- **Role:** Adversarial testing.
- **Note:** If time is short, rely on manual audit + Bankrun for v1.

### 3. Scenario Layer: Mocha/Anchor (Keep As-Is)
- **Role:** Integration & RPC flow.
- **Refactor:** Split `deadmans-switch.ts` into:
  - `tests/e2e/claim-flow.ts`
  - `tests/e2e/delegate-flow.ts`

## ðŸ› ï¸ Implementation Specs

### Setup Bankrun
1.  Install: `yarn add -D solana-bankrun bankrun-anchor`
2.  Create `tests/bankrun/` directory.
3.  Migrate logic tests (e.g., "initialize vault", "ping").

## âœ… Success Metrics
- `yarn test:fast` (Bankrun) completes in < 1s.
- Critical paths (Ping, Claim) covered by Bankrun.
