# 4.4 Testing & Deploy

## Mục tiêu
Run final tests, fix issues, và deploy lên Solana Mainnet.

## Testing Checklist

### Smart Contract Tests (Anchor)
```bash
cd anchor
anchor test
```

**Required Pass:**
- [ ] Initialize vault với valid params
- [ ] Ping updates timestamp
- [ ] Unauthorized ping fails
- [ ] Release chỉ khi expired
- [ ] Recipient access check đúng

### Encryption Tests
- [ ] Encrypt → Decrypt cycle đúng
- [ ] Wrong key → fail gracefully
- [ ] Network tab chỉ thấy ciphertext

### E2E Manual Test (Happy Path)
1. [ ] Connect wallet (Owner)
2. [ ] Create vault với file nhỏ
3. [ ] Check-in thành công, timer reset
4. [ ] Disconnect, connect Recipient wallet
5. [ ] Vault locked → button disabled
6. [ ] (Simulate expire) → Vault released
7. [ ] Decrypt & download → file đúng

### Edge Cases
- [ ] File 50MB → encrypt không crash
- [ ] File 100MB → reject với error message
- [ ] Wallet 0 SOL → friendly error
- [ ] Network timeout → retry hoặc error

## Deploy to Mainnet

### 1. Update Config
```toml
# Anchor.toml
[programs.mainnet]
deadmans_switch = "<MAINNET_PROGRAM_ID>"

[provider]
cluster = "mainnet"
```

### 2. Build & Deploy
```bash
anchor build
anchor deploy --provider.cluster mainnet
```

### 3. Frontend Config
```env
NEXT_PUBLIC_NETWORK=mainnet
NEXT_PUBLIC_PROGRAM_ID=<mainnet_id>
NEXT_PUBLIC_RPC_URL=<helius_or_quicknode>
```

### 4. Smoke Test on Mainnet
- [ ] Create 1 real vault với 0.01 SOL
- [ ] Verify on Solana Explorer
- [ ] Check-in hoạt động

## Pre-Launch Checklist
- [ ] All tests pass
- [ ] Environment variables set
- [ ] Domain configured
- [ ] Error monitoring setup (Sentry optional)
- [ ] Backup wallet keypairs

## Acceptance Criteria
- [ ] Program live trên Mainnet
- [ ] Smoke test pass
- [ ] No critical bugs remaining
