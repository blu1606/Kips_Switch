# 1.2 Smart Contract (Solana Program)

## Mục tiêu
Viết Solana Program bằng Anchor để quản lý Vault với PDA.

## Core Data Structure

### Vault Account
```rust
#[account]
pub struct Vault {
    pub owner: Pubkey,          // 32 bytes - wallet tạo vault
    pub recipient: Pubkey,      // 32 bytes - wallet nhận khi release
    pub ipfs_cid: String,       // ~64 bytes - CID của encrypted file
    pub encrypted_key: String,  // ~128 bytes - AES key đã mã hóa
    pub time_interval: i64,     // 8 bytes - thời gian check-in (seconds)
    pub last_check_in: i64,     // 8 bytes - timestamp lần check-in cuối
    pub is_released: bool,      // 1 byte - đã release chưa
    pub bump: u8,               // 1 byte - PDA bump seed
}
```

### PDA Seeds
```rust
seeds = [b"vault", owner.key().as_ref()]
```
> MVP: Mỗi wallet chỉ có 1 vault. Phase 2 có thể thêm `vault_id`.

## Instructions

### 1. `initialize_vault`
**Input:** `ipfs_cid`, `encrypted_key`, `recipient`, `time_interval`
**Logic:**
- Tạo PDA account cho Vault
- Set `last_check_in = Clock::get().unix_timestamp`
- Set `is_released = false`

### 2. `ping` (Check-in)
**Signer:** Owner only
**Logic:** Update `last_check_in = now`

### 3. `trigger_release`
**Callable by:** Anyone
**Logic:**
- Check `now > last_check_in + time_interval`
- If true → set `is_released = true`

## Security Constraints
- `ping`: Chỉ owner mới được gọi
- `trigger_release`: Public nhưng chỉ hoạt động khi đã quá hạn
- Không cho phép modify vault của người khác

## Acceptance Criteria
- [ ] `anchor build` pass
- [ ] `anchor test` pass với các test case:
  - Init vault thành công
  - Ping reset timer
  - Stranger không ping được
  - Release chỉ hoạt động khi expired
